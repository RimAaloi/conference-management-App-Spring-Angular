<div class="page">
    <header class="header">
        <h1 class="header-title">Gestion des Conf√©rences</h1>
        <div class="header-actions">
            <button class="btn btn-primary" (click)="openCreateModal()">
                ‚ûï Nouvelle Conf√©rence
            </button>
        </div>
    </header>

    <div class="content-area">
        <!-- Alerts -->
        @if (successMessage()) {
        <div class="alert alert-success">‚úì {{ successMessage() }}</div>
        }
        @if (errorMessage()) {
        <div class="alert alert-danger">‚úï {{ errorMessage() }}</div>
        }

        <!-- Filters -->
        <div class="filters mb-3">
            <input type="text" class="form-control search-input" placeholder="üîç Rechercher par titre..."
                [(ngModel)]="searchTerm">
            <select class="form-control filter-select" [(ngModel)]="filterType">
                <option value="">Tous les types</option>
                <option value="ACADEMIC">Acad√©mique</option>
                <option value="COMMERCIAL">Commercial</option>
            </select>
        </div>

        <!-- Content -->
        @if (loading()) {
        <div class="loading-container">
            <div class="loading-spinner"></div>
        </div>
        } @else {
        @if (getFilteredConferences().length === 0) {
        <div class="card">
            <div class="empty-state">
                <div class="empty-state-icon">üìÖ</div>
                <h3>Aucune conf√©rence trouv√©e</h3>
                <p>Cr√©ez votre premi√®re conf√©rence</p>
                <button class="btn btn-primary" (click)="openCreateModal()">
                    ‚ûï Cr√©er une conf√©rence
                </button>
            </div>
        </div>
        } @else {
        <div class="conferences-grid">
            @for (conference of getFilteredConferences(); track conference.id) {
            <div class="conference-card">
                <div class="conference-header">
                    <span class="badge" [class.badge-academic]="conference.type === 'ACADEMIC'"
                        [class.badge-commercial]="conference.type === 'COMMERCIAL'">
                        {{ conference.type === 'ACADEMIC' ? 'üéì Acad√©mique' : 'üíº Commercial' }}
                    </span>
                    <div class="stars">
                        @for (filled of getStarArray(conference.score); track $index) {
                        <span class="star" [class.filled]="filled">‚òÖ</span>
                        }
                    </div>
                </div>

                <h3 class="conference-title">{{ conference.titre }}</h3>

                <div class="conference-meta">
                    <div class="meta-item">
                        <span class="meta-icon">üìÖ</span>
                        <span>{{ conference.date }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">‚è±Ô∏è</span>
                        <span>{{ conference.duree }} min</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">üë•</span>
                        <span>{{ conference.nombreInscrits }} inscrits</span>
                    </div>
                </div>

                @if (conference.keynote) {
                <div class="conference-keynote">
                    <div class="keynote-avatar-sm">
                        {{ conference.keynote.prenom.charAt(0) }}{{ conference.keynote.nom.charAt(0) }}
                    </div>
                    <span>{{ conference.keynote.prenom }} {{ conference.keynote.nom }}</span>
                </div>
                }

                <div class="conference-actions">
                    <button class="btn btn-secondary btn-sm" (click)="openDetailModal(conference)">
                        üëÅÔ∏è D√©tails
                    </button>
                    <button class="btn btn-secondary btn-sm" (click)="openReviewModal(conference)">
                        ‚≠ê Review
                    </button>
                    <button class="btn btn-secondary btn-sm" (click)="openEditModal(conference)">
                        ‚úèÔ∏è
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="deleteConference(conference)">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
            }
        </div>
        }
        }
    </div>
</div>

<!-- Create/Edit Modal -->
@if (showModal()) {
<div class="modal-backdrop" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">
                {{ editMode() ? 'Modifier la Conf√©rence' : 'Nouvelle Conf√©rence' }}
            </h3>
            <button class="modal-close" (click)="closeModal()">&times;</button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Titre</label>
                <input type="text" class="form-control" [(ngModel)]="currentConference.titre"
                    placeholder="Titre de la conf√©rence">
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-control" [(ngModel)]="currentConference.type">
                        <option value="ACADEMIC">Acad√©mique</option>
                        <option value="COMMERCIAL">Commercial</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-control" [(ngModel)]="currentConference.date">
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label class="form-label">Dur√©e (minutes)</label>
                    <input type="number" class="form-control" [(ngModel)]="currentConference.duree" min="15">
                </div>
                <div class="form-group">
                    <label class="form-label">Nombre d'inscrits</label>
                    <input type="number" class="form-control" [(ngModel)]="currentConference.nombreInscrits" min="0">
                </div>
            </div>

            <div class="form-group mb-0">
                <label class="form-label">Keynote</label>
                <select class="form-control" [(ngModel)]="currentConference.keynoteId">
                    <option [ngValue]="undefined">-- S√©lectionner un keynote --</option>
                    @for (keynote of keynotes(); track keynote.id) {
                    <option [ngValue]="keynote.id">{{ keynote.prenom }} {{ keynote.nom }} - {{ keynote.fonction }}
                    </option>
                    }
                </select>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModal()">Annuler</button>
            <button class="btn btn-primary" (click)="saveConference()">
                {{ editMode() ? 'Mettre √† jour' : 'Cr√©er' }}
            </button>
        </div>
    </div>
</div>
}

<!-- Review Modal -->
@if (showReviewModal()) {
<div class="modal-backdrop" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">Ajouter une Review</h3>
            <button class="modal-close" (click)="closeModal()">&times;</button>
        </div>

        <div class="modal-body">
            <p class="text-secondary mb-2">Conference: <strong>{{ selectedConference()?.titre }}</strong></p>

            <div class="form-group">
                <label class="form-label">Note</label>
                <div class="rating-input">
                    @for (star of [1, 2, 3, 4, 5]; track star) {
                    <span class="star star-input" [class.filled]="star <= newReview.note"
                        (click)="setRating(star)">‚òÖ</span>
                    }
                    <span class="rating-text">{{ newReview.note }}/5</span>
                </div>
            </div>

            <div class="form-group mb-0">
                <label class="form-label">Commentaire</label>
                <textarea class="form-control" [(ngModel)]="newReview.texte" rows="4"
                    placeholder="Votre avis sur cette conf√©rence..."></textarea>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" (click)="closeModal()">Annuler</button>
            <button class="btn btn-primary" (click)="addReview()">Ajouter la Review</button>
        </div>
    </div>
</div>
}

<!-- Detail Modal -->
@if (showDetailModal() && selectedConference()) {
<div class="modal-backdrop" (click)="closeModal()">
    <div class="modal modal-lg" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">{{ selectedConference()?.titre }}</h3>
            <button class="modal-close" (click)="closeModal()">&times;</button>
        </div>

        <div class="modal-body">
            <div class="detail-section">
                <h4>Informations</h4>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Type</span>
                        <span class="badge" [class.badge-academic]="selectedConference()?.type === 'ACADEMIC'"
                            [class.badge-commercial]="selectedConference()?.type === 'COMMERCIAL'">
                            {{ selectedConference()?.type }}
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Date</span>
                        <span>{{ selectedConference()?.date }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Dur√©e</span>
                        <span>{{ selectedConference()?.duree }} minutes</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Inscrits</span>
                        <span>{{ selectedConference()?.nombreInscrits }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Score</span>
                        <div class="stars">
                            @for (filled of getStarArray(selectedConference()?.score); track $index) {
                            <span class="star" [class.filled]="filled">‚òÖ</span>
                            }
                            <span class="ml-1">({{ selectedConference()?.score || 0 }}/5)</span>
                        </div>
                    </div>
                </div>
            </div>

            @if (selectedConference()?.keynote) {
            <div class="detail-section">
                <h4>Keynote Speaker</h4>
                <div class="keynote-detail">
                    <div class="keynote-avatar-lg">
                        {{ selectedConference()?.keynote?.prenom?.charAt(0) }}{{
                        selectedConference()?.keynote?.nom?.charAt(0) }}
                    </div>
                    <div>
                        <h5>{{ selectedConference()?.keynote?.prenom }} {{ selectedConference()?.keynote?.nom }}</h5>
                        <p>{{ selectedConference()?.keynote?.fonction }}</p>
                        <a href="mailto:{{ selectedConference()?.keynote?.email }}">{{
                            selectedConference()?.keynote?.email }}</a>
                    </div>
                </div>
            </div>
            }

            <div class="detail-section">
                <h4>Reviews ({{ selectedConference()?.reviews?.length || 0 }})</h4>
                @if (!selectedConference()?.reviews?.length) {
                <p class="text-muted">Aucune review pour cette conf√©rence</p>
                } @else {
                <div class="reviews-list">
                    @for (review of selectedConference()?.reviews; track review.id) {
                    <div class="review-item">
                        <div class="review-header">
                            <div class="stars">
                                @for (i of [1,2,3,4,5]; track i) {
                                <span class="star" [class.filled]="i <= review.note">‚òÖ</span>
                                }
                            </div>
                            <span class="review-date">{{ review.date }}</span>
                        </div>
                        <p class="review-text">{{ review.texte }}</p>
                    </div>
                    }
                </div>
                }
            </div>
        </div>
    </div>
</div>
}